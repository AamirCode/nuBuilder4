<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>nuBuilder's Ace Code Editor</title>

<style>
.nuAce {
	position:absolute;
	border-style:none;
	font-family:helvetica;
	font-size:14px;
	font-weight:bold;
	background-color:black;
	width:300px;
	height:20px;
	top:40px;
}

.nuTool {
	padding:4px;
	font-family:helvetica;
	font-size:14px;
	color:white;
	background-color:grey;
}

.nuTool:hover {
	background-color:orange;
	cursor:pointer;
}

</style>

<script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="ace/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="ace/src-noconflict/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>

<script>

window.c = opener.window.nuAce[0];
window.o = opener.window.nuAce[1];
window.l = opener.document.getElementById('label_' + o).innerHTML;   
window.t = opener.window.nuFORM.tableSchema;
window.f = opener.window.nuFORM.formSchema;

function nuLoad(){

	ace.require("ace/ext/language_tools");
	
    window.editor = ace.edit("nu_editor");
	
    editor.setTheme("ace/theme/monokai");
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    });


	window.startValue = opener.window.document.getElementById(window.o).value;
	editor.setFontSize(14);

	if ( window.c == 'CSS' ) 		{editor.getSession().setMode({path:"ace/mode/css", inline:true});}
	if ( window.c == 'HTML' ) 		{editor.getSession().setMode({path:"ace/mode/html", inline:true});}
	if ( window.c == 'Javascript' ) {editor.getSession().setMode({path:"ace/mode/javascript", inline:true});}
	if ( window.c == 'MySql' ) 		{editor.getSession().setMode({path:"ace/mode/mysql", inline:true});}
	if ( window.c == 'PHP' ) 		{editor.getSession().setMode({path:"ace/mode/php", inline:true});}
	if ( window.c == 'SQL' ) 		{editor.getSession().setMode({path:"ace/mode/sql", inline:true});}

	document.getElementById('nu_details').innerHTML   = '<i>' + l + '</i>&nbsp;&nbsp;<b>' + o + '</b>';
	document.getElementById('nu_language').innerHTML   = c;
	
	nuResize();
	
	editor.setValue(window.startValue);
	editor.focus();
	editor.navigateFileStart();

}

function nuResize(){

   document.getElementById('nu_editor').style.width     = String(Number(window.innerWidth)) 		+ 'px';
   document.getElementById('nu_editor').style.height    = String(Number(window.innerHeight) - 60) 	+ 'px';
   
}

function nuAceSave(){
debugger;
	window.nuWarn      = 0;

	opener.window.document.getElementById(o).value = editor.getValue();

	if ("createEvent" in document) {

		var evt = document.createEvent("HTMLEvents");
		
		evt.initEvent("change", false, true);
		
		opener.window.document.getElementById(window.o).dispatchEvent(evt);
		
	}else{
		opener.window.document.getElementById(window.o).fireEvent("onchange");
	}

	window.close();

}

function nuWarning(){

	if(editor.getValue() != window.startValue && window.nuWarn == 1){
		return "Close this window without Saving?";
	}

}


function nuUpdateDrag(t){

	document.getElementById('nuDrag').value = document.getElementById('nuField')[t.value].innerHTML;

}

function nuChooseFields(){

	var n = document.getElementById('nuTable').value;
	var t = window.s[n];
	var f = document.getElementById('nuField').value;

	document.getElementById('nuDrag').value = t.fields[f];
	
}

function nuChooseSnips(t){

	document.getElementById('nuDrag').value = t.value;
	
}


window.nuWarn         = 1;
window.onbeforeunload = nuWarning;

</script>

</head>
<body style='background-color:#000000' onload='nuLoad()' onresize='nuResize()'>

	<span id='copytonu' 	style='top:5px;left:50px;' onclick='nuAceSave()' class='nuTool'>Copy Changes</span>
	<span id='nu_language' 	style='top:10px;right:20px;text-align:left;color:lightblue;font-family:helvetica;font-size:12px;position:absolute'></span>
	<span id='nu_details' 	style='bottom:5px;right:20px;text-align:left;color:lightblue;font-family:helvetica;font-size:12px;position:absolute'></span>
	<div  id='nu_editor'	style='width:1000px;height:800px;top:35px;left:0px;text-align:left;position:absolute'></div>

</body>
</html> 

